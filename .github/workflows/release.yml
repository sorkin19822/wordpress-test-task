name: Create Release

on:
  push:
    tags:
      - 'v*.*.*'

permissions:
  contents: write

jobs:
  build:
    name: Create Release
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Create plugin ZIP
        run: |
          # Create temporary directory
          mkdir -p wp-product-plugin-release

          # Copy plugin files (exclude dev files)
          rsync -av \
            --exclude='.git' \
            --exclude='.github' \
            --exclude='.gitignore' \
            --exclude='.idea' \
            --exclude='.vscode' \
            --exclude='node_modules' \
            --exclude='docker-compose.yml' \
            --exclude='temp' \
            --exclude='.DS_Store' \
            --exclude='*.md' \
            --exclude='LICENSE' \
            ./ wp-product-plugin-release/

          # Create ZIP file
          cd wp-product-plugin-release
          zip -r ../wp-product-plugin.zip .
          cd ..

          # Cleanup
          rm -rf wp-product-plugin-release

      - name: Get version from tag
        id: get_version
        run: echo "VERSION=${GITHUB_REF#refs/tags/v}" >> $GITHUB_OUTPUT

      - name: Create Release
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          gh release create ${{ github.ref_name }} \
            --title "Release ${{ steps.get_version.outputs.VERSION }}" \
            --notes "## WP Product Plugin v${{ steps.get_version.outputs.VERSION }}

          ### Installation
          1. Download \`wp-product-plugin.zip\` below
          2. Go to WordPress admin → Plugins → Add New → Upload Plugin
          3. Choose the downloaded ZIP file
          4. Click \"Install Now\" and then \"Activate\"
          5. Configure settings at Settings → Product Plugin

          ### Features
          - FakeStore API integration
          - Two shortcodes: \`[product_display]\` and \`[random_product]\`
          - AJAX-powered random product loading
          - Custom Post Type for products
          - Automatic image download
          - Enhanced WordPress 6 compatible styles
          - Admin settings page

          ### What's New
          - Modern gradient design with enhanced styles
          - Hover animations and smooth transitions
          - Responsive design for all devices
          - Dark mode support
          - Admin toggle for enhanced styles" \
            ./wp-product-plugin.zip
